# ==========================================
# Polymarket SDK & Frontend 环境变量配置字典
# ==========================================

# ------------------------------------------
# 基础服务与数据库 (Database & Infra)
# ------------------------------------------
# 核心业务数据库连接 URL ( Prisma 专用 )
DATABASE_URL="file:./dev.db"

# ------------------------------------------
# 链上网络与节点配置 (Network & Chain Options)
# ------------------------------------------
# (客户端可见) 网络环境标识：localhost(本地测试), amoy(测试网), polygon(主网)
NEXT_PUBLIC_NETWORK=localhost
# (客户端可见) 链 ID (Chain ID)：本地通常为 31337，Amoy 80002，Polygon 主网是 137
NEXT_PUBLIC_CHAIN_ID=31337
# (客户端可见) RPC 访问节点地址，前端和钱包请求智能合约数据会使用这个节点
NEXT_PUBLIC_RPC_URL=http://127.0.0.1:8545
# Hardhat 分叉网络 RPC：当你跑后端智能合约测试脚本时，基于哪个真实网络分叉数据
MAINNET_FORK_RPC_URL="https://polygon-rpc.com"

# ------------------------------------------
# 智能合约地址 (Contract Addresses)
# ------------------------------------------
# 以下变量前端均可见，通常由部署脚本生成。如果留空，通常会有 fallback。
NEXT_PUBLIC_PROXY_FACTORY_ADDRESS=   # 智能钱包代理工厂 (Proxy Factory) 合约地址
NEXT_PUBLIC_TREASURY_ADDRESS=        # 收益流国库 (Treasury) 合约地址
NEXT_PUBLIC_EXECUTOR_ADDRESS=        # 跟单任务执行器 (Executor) 合约地址
NEXT_PUBLIC_USDC_ADDRESS=            # USDC 支付代币合约地址
NEXT_PUBLIC_CTF_ADDRESS=             # Polymarket 条件代币框架 (CTF) 合约地址
NEXT_PUBLIC_BOT_ADDRESS=             # 自主跟单机器人 (Bot) 核心合约地址

# ------------------------------------------
# 重要密钥数据 (Private Keys - 仅服务端可用！)
# ------------------------------------------
# 系统交易员 / Backend Server 发起交易时使用的 EOA 私钥 (务必不可泄露给前端)
TRADING_PRIVATE_KEY=
# 或者使用助记词导出账号
TRADING_MNEMONIC=

# ------------------------------------------
# Polymarket 订单簿 API 鉴权 (Polymarket CLOB)
# ------------------------------------------
# 如果需要开启真实的 Polymarket 现货挂单，则需要生成对应的 CLOB Credentials，这三个字段必须有
POLY_API_KEY=
POLY_API_SECRET=
POLY_API_PASSPHRASE=

# ------------------------------------------
# 跟单交易 (Copy Trading Execution) 基础风控参数
# ------------------------------------------
# 是否开启【真实代币】跟单交易。=false 时则只打印日志/发模拟交易，不产生消耗。
ENABLE_REAL_TRADING=false
# 跟单引擎通过轮询此 前端 API 服务，获取最新的跟单指令和队列（通常为前端 host）
COPY_TRADING_API_URL=http://localhost:3000

# (风控) 单日所有跟单交易金额的最大上限 (美元)
COPY_TRADING_DAILY_CAP_USD=
# (风控) 针对某个具体跟单钱包的单次/单日最大跟单限额 (美元)
COPY_TRADING_WALLET_DAILY_CAP_USD=
# (风控) 针对某个特定市场的最大允许跟单总额限制 (美元)
COPY_TRADING_MARKET_DAILY_CAP_USD=
# (风控) 多市场自定义限额，JSON 字符串格式
COPY_TRADING_MARKET_CAPS=
# 跟单执行白名单列表，如果在列表中才能执行
COPY_TRADING_EXECUTION_ALLOWLIST=
# Worker (具体代打执行线程) 白名单，多节点执行时防止冲突
COPY_TRADING_WORKER_ALLOWLIST=
# (风控) **单笔**最大的允许跟单金额限制，超过该阈值被拦截
COPY_TRADING_MAX_TRADE_USD=
# (风控) 一个固定时间窗口内允许的最大高频发单次数
COPY_TRADING_MAX_TRADES_PER_WINDOW=
# 上述高频发单的统计时间窗口，默认 600000 毫秒（即 10 分钟）
COPY_TRADING_TRADE_WINDOW_MS=600000
# 紧急熔断开关 - 置为 true 后立刻中止所有发起的交易和信号追踪
COPY_TRADING_EMERGENCY_PAUSE=false
# 一旦开启就会“虚构执行”(Dry Run)，即走完业务校验全流程，但就是不提交上链
COPY_TRADING_DRY_RUN=false
# 风控日志告警发送频率限制 (默认每分钟只发送一次通知，避免日志风暴)
COPY_TRADING_GUARDRAIL_LOG_INTERVAL_MS=60000
# 风控触发次数阈值（譬如单小时内熔断20次则发邮件/TG高级警告）
COPY_TRADING_GUARDRAIL_ALERT_THRESHOLD=20
# (检查项) 跟单代打钱包至少要保有的 MATIC 余额，低于该数额不足以支付 Gas 而拒单
COPY_TRADING_MIN_WALLET_MATIC=0.1
# (检查项) 代扣资金至少保留多少 USDC 在代理账户内
COPY_TRADING_MIN_PROXY_USDC=1

# ------------------------------------------
# 轮询 / 信号源 / Websocket (Signal & Node Mode)
# ------------------------------------------
# 发送跟单上链具体用的 RPC 节点，可与前端 NEXT_PUBLIC_RPC_URL 独立，以保证不被限流
COPY_TRADING_RPC_URL=
# 备用 RPC 节点池列表 (逗号分隔)，用于自动故障转移(failover)
COPY_TRADING_RPC_URLS=
# WS 连接 Polymarket 服务时是否过滤特定的合约地址，减少收到无关消息的情况
COPY_TRADING_WS_FILTER_BY_ADDRESS=false
# 信号监听的工作模式：WS_ONLY(全 Websocket), POLLING_ONLY(全 HTTP轮询), HYBRID(智能切换)
COPY_TRADING_SIGNAL_MODE=HYBRID

# HTTP 信号轮询的基础间隔 / 最大间隔限制配置 (毫秒)
SUPERVISOR_POLLING_BASE_INTERVAL_MS=5000
SUPERVISOR_POLLING_MAX_INTERVAL_MS=10000
SUPERVISOR_POLLING_LIMIT=200
SUPERVISOR_POLLING_LOOKBACK_SECONDS=90
# 如果 Websocket 多长时间收不到任何消息被判定为静默/心跳超时丢包，则发生重连 (30秒)
SUPERVISOR_WS_UNHEALTHY_THRESHOLD_MS=30000
SUPERVISOR_SIGNAL_SOURCE_WINDOW_MS=120000

# ------------------------------------------
# 重试 / 幂等性控制 / 异步结算 (Queues & Execution)
# ------------------------------------------
# 下单前校验价格的缓存生存期，过期后会强制向系统再读一次盘口价
COPY_TRADING_PRICE_TTL_MS=5000
# 数据去重要素：同一个跟单事件多长时间内属于“幂等”，不再触发第二笔单
COPY_TRADING_IDEMPOTENCY_BUCKET_MS=5000
# Worker 特定的独立身份密钥配置
COPY_TRADING_WORKER_KEYS=
# Worker 在分布式集群运行时的所在索引序号(0, 1, 2...)
COPY_TRADING_WORKER_INDEX=0

# 下单队列常规失败重试的最大次数
COPY_TRADING_MAX_RETRY_ATTEMPTS=2
# 每次重试间的退避延迟 (Backoff)
COPY_TRADING_RETRY_BACKOFF_MS=60000
COPY_TRADING_RETRY_INTERVAL_MS=60000

# 异步结算控制相关配置开关（下注结束后的奖金计算和入账）
COPY_TRADING_ASYNC_SETTLEMENT=false
COPY_TRADING_SETTLEMENT_MAX_RETRY_ATTEMPTS=5
COPY_TRADING_SETTLEMENT_RETRY_BACKOFF_MS=60000

# 预支资金分类账（Ledger）功能
COPY_TRADING_LEDGER_ENABLED=false
COPY_TRADING_LEDGER_FLUSH_AMOUNT=100
COPY_TRADING_LEDGER_MAX_AGE_MS=300000
COPY_TRADING_LEDGER_OUTSTANDING_CAP=0
COPY_TRADING_LEDGER_FLUSH_INTERVAL_MS=60000
COPY_TRADING_LEDGER_MAX_RETRY_ATTEMPTS=5
COPY_TRADING_LEDGER_RETRY_BACKOFF_MS=60000
COPY_TRADING_LEDGER_CLAIM_BATCH=50

# ------------------------------------------
# Mempool 层防御与极速模式 (Speed Mode)
# ------------------------------------------
# 在发单时监听内存池使用的厂商驱动 (推荐 STANDARD 或者 ALCHEMY - 通过自有节点发隐藏单)
MEMPOOL_PROVIDER=STANDARD
# (客户端可见) Alchemy 的 API 秘钥，开启 Alchemy 防抢跑 / 高级 RPC 支持
NEXT_PUBLIC_ALCHEMY_API_KEY=

# 是否开启极速模式（跳过多数风控以提升上链速度）
COPY_TRADING_SPEED_MODE=false
# 执行流策略倾向：standard（标准稳定型）, speed (极高竞争性，允许一定滑点换速度)
COPY_TRADING_SPEED_PROFILE=standard
# 极速跟单模式下的允许最高滑度底线 (滑点，80 BPS 也就是 0.8%)
COPY_TRADING_MAX_SPREAD_BPS=80
# 盘口要求最小可成交流动深度 (防止微量虚假挂单骗我们入场)
COPY_TRADING_MIN_DEPTH_USD=10
COPY_TRADING_MIN_DEPTH_RATIO=1.2
COPY_TRADING_DEPTH_LEVELS=5

# ------------------------------------------
# 脚本应用特有功能配置区 (Script & Feature Configs)
# ------------------------------------------

# 【1. 托管资金流流转 (Managed Wealth) 的定时任务】
MANAGED_WEALTH_LOOP_INTERVAL_MS=60000         # 循环处理主控进程休眠多久 (毫秒)
MANAGED_WEALTH_MAP_BATCH_SIZE=100           # 单次批处理的托管资产映射份额上限
MANAGED_WEALTH_NAV_BATCH_SIZE=100           # 批量计算代币净值份额上限
MANAGED_WEALTH_SETTLEMENT_BATCH_SIZE=50     # 批量从托管池清算的队列数
MANAGED_WEALTH_REQUIRE_SIGNATURE=true       # 提报结算时是否需要严格带签名
MANAGED_WEALTH_RUN_ONCE=false               # Worker进程跑一遍就退出？(=true用于CI系统)
NEXT_PUBLIC_MANAGED_WEALTH_SIGN_REQUESTS=true # 客户端传单给托管池时是否要主动签名授权
MW_VERIFY_ADMIN_WALLET=                     # 验证专用 Admin 管理台验证钱包地址
MW_VERIFY_BASE_URL=                         # 对接的托管后台专用核心验证 URL

# 【2. Supervisor 及监控相关微调 (Monitoring Tools)】
SUPERVISOR_WORKER_POOL_SIZE=10              # 爬虫/监听的内置工作线程池数
SUPERVISOR_FANOUT_CONCURRENCY=50            # 将捕获的信号广播下发的并发数并发下限
SUPERVISOR_CONFIG_FULL_REFRESH_MS=3600000   # 全量配置自动刷新的周期 (1小时=3600秒)
SUPERVISOR_CONFIG_REFRESH_MS=300000         # 热更改的短暂刷新周期 (5分钟=300秒)
SUPERVISOR_QUEUE_MAX_SIZE=10000             # 积压在内存中的订单事件如果多于 10000 则拒绝
SUPERVISOR_SHARD_COUNT=1                    # 对于多机器的分布式监控拆几个节点？
SUPERVISOR_SHARD_INDEX=0                    # 本机器当前索引是几？
ORDERS_LOG_PATH=./logs/orders.log           # 本地持久化监控订单事件的文件名

# 【3. 本地模拟调试专用 (Live Copy Trading Scripts)】
FOLLOWER_WALLET=                            # 用于模拟跟随的假钱包地址
TARGET_TRADER=                              # 你在模拟环境特定想监听的一个老唐大佬地址
FIXED_COPY_AMOUNT=10                        # 模拟环境每一次测试发出来的跟单金额(单位U)
SIM_COPY_MODE=BUDGET_CONSTRAINED            # 模拟环境模式 (预算有限模式)
SIM_ACTIVITY_FILTER=TRADER_ONLY             # 仅提取该指定交易员的日志动作
SIM_WS_SERVER_FILTER=false                  # 是否在本地起假 WS 服务做断言网兜

# 【4. 前端自动化测试套件 Playwright (E2E Testing)】
NEXT_PUBLIC_E2E_MOCK_AUTH=false             # 是否让测试脚本直接 Bypass(免登) 登录系统
NEXT_PUBLIC_E2E_MOCK_WALLET=0x1111111111111111111111111111111111111111 # 注入给假登录用 Mock 的钱包地址
PLAYWRIGHT_BASE_URL=http://127.0.0.1:3210   # QA 工具用哪个页面做 UI 分析 
PLAYWRIGHT_PORT=3210                        # E2E 隔离环境跑什么端口 

# 【5. 基础设施类核心 (Infrastructure & Servers)】
REDIS_URL=redis://localhost:6379            # 通用 Redis，用于前台页面加速 / Token 存储等
SUPERVISOR_REDIS_URL=redis://localhost:6379 # 业务后端的独立 Redis（强烈建议分库以免互相剔除缓存）
ENCRYPTION_KEY=0000000000000000000000000000000000000000000000000000000000000000 # 数据库敏感数据落库时的 256位 加密混淆密钥
POSTGRES_PRISMA_URL=                        # 若需要做连接池优化，这里写入独立的云连接字符串
CRON_SECRET=                                # (API鉴权) 定时任务触发网关唯一鉴权令牌
ADMIN_WALLETS=                              # Admin / Owner 系统超级管理员全局钱包列表 (逗号分隔)

